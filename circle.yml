machine:
  services:
    - docker
dependencies:
  pre:
    - if [[ ! -e ~/rainman ]]; then git clone git@github.com:Mayvenn/rainman.git ~/rainman; fi
    - cd ~/rainman && git pull
    - cd ~/rainman && (bundle check --path ~/rainman-gems || bundle --path ~/rainman-gems --retry 3 --jobs 4)
    - cd ~/rainman && git submodule update --init
  cache_directories:
    - ~/rainman-gems
    - ~/rainman
general:
  branches:
    only:
      - master
deployment:
  acceptance:
    branch: master
    owner: Mayvenn
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - git config --global user.email "justin+mayvenn-bot@mayvenn.com"
      - git config --global user.name "Mayvenn-Bot"
      # - cd ~/rainman && bundle exec ./rain storefront acceptance
      # - curl -X POST https://circleci.com/api/v1/project/Mayvenn/heat/tree/master?circle-token=${HEAT_TOKEN}
